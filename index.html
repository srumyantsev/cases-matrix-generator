<!DOCTYPE html>
<html lang="en">

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Cases matrix generator">
    <title>Cases matrix generator</title>
    <link rel="stylesheet" href="./pure.css" />
    <!--[if lte IE 8]>
        <link rel="stylesheet" href="./grids-responsive-old-ie.css">
    <![endif]-->
    <!--[if gt IE 8]><!-->
    <link rel="stylesheet" href="./grids-responsive.css">
    <!--<![endif]-->
    <script type="text/javascript" src="./vue.js"></script>
    <script type="text/javascript">
        const ControlTypes = {
            // TEXT: 'text',
            SELECT: 'select',
            RESULT: 'result',
        };

        //http://cwestblog.com/2011/05/02/cartesian-product-of-multiple-arrays/
        function cartesianProductOf() {
            return Array.prototype.reduce.call(arguments, function (a, b) {
                var ret = [];
                a.forEach(function (a) {
                    b.forEach(function (b) {
                        ret.push(a.concat([b]));
                    });
                });
                return ret;
            }, [[]]);
        }

        window.addEventListener("load", function (event) {
            new Vue({
                el: '#app',
                data: {
                    requirements: [
                        { title: 'Select example', type: ControlTypes.SELECT, options: [{ value: "Option #1" }, { value: "Option #2" }] },
                        { title: 'Select example', type: ControlTypes.SELECT, options: [{ value: "Option #A" }, { value: "Option #B" }, { value: "Option #C" }] },
                        { title: 'Result example', type: ControlTypes.RESULT, options: [{ value: "Option #1" }] }
                    ],
                    ControlTypes: ControlTypes,
                },
                computed: {
                    resultCases: function () {
                        return cartesianProductOf(...this.requirements.map(r => r.options.map(o => r.type === ControlTypes.SELECT ? o.value : "&nbsp;")));
                    }
                },
                methods: {
                    deleteItem: function (collection, itemIndex) {
                        collection.splice(itemIndex, 1);
                    },
                    moveItem: function (collection, originalIndex, isUp) {
                        let newIndex = isUp ? originalIndex - 1 : originalIndex + 1;
                        let itemToMove = collection[originalIndex];
                        Vue.set(collection, originalIndex, collection[newIndex]);
                        Vue.set(collection, newIndex, itemToMove);
                    },
                    addRequirement: function (requirementIndex, isBefore) {
                        let indexToAdd = isBefore ? requirementIndex : requirementIndex + 1;
                        this.requirements.splice(indexToAdd, 0, this.createNewRequirement())
                    },
                    addRequirementOption: function (options, optionIndex, isBefore) {
                        let indexToAdd = isBefore ? optionIndex : optionIndex + 1;
                        options.splice(indexToAdd, 0, { value: "Option" });
                    },
                    createNewRequirement: function () {
                        return { title: 'Select example', type: ControlTypes.SELECT, options: [{ value: "Option #1" }] };
                    }
                }
            });
        });
    </script>
    <style type="text/css">
        table {
            margin: 20px auto;
        }

        .button-xsmall {
            font-size: 70%;
        }
    </style>
</head>

<body>
    <div class="pure-g">
        <div class="pure-u-3-24">&nbsp;</div>
        <div class="pure-u-18-24">
            <div id="app">
                <h1>Requirements</h1>
                <table class="pure-table pure-table-bordered">
                    <thead>
                        <tr>
                            <th>Title</th>
                            <th>Type</th>
                            <th>Options</th>
                            <th>Actions</th>
                        </tr>
                    </thead>

                    <tbody>
                        <tr v-for="(requirement, requirementIndex) in requirements">
                            <td>
                                <input type="text" v-model="requirement.title" />
                            </td>
                            <td>
                                <select v-model="requirement.type">
                                    <!-- <option>{{ ControlTypes.TEXT }}</option> -->
                                    <option>{{ ControlTypes.SELECT }}</option>
                                    <option>{{ ControlTypes.RESULT }}</option>
                                </select>
                            </td>
                            <td>
                                <template v-if="requirement.type === ControlTypes.SELECT">
                                    <table class="pure-table pure-table-bordered">
                                        <tbody>
                                            <tr v-for="(option, optionIndex) in requirement.options">
                                                <td><input type="text" v-model="option.value" /></td>
                                                <td>
                                                    <button class="pure-button pure-button-primary button-xsmall"
                                                        :class="{ 'pure-button-disabled': optionIndex === 0 }"
                                                        :disabled="optionIndex === 0" @click="moveItem(requirement.options, optionIndex, true)">Up</button>
                                                    <button class="pure-button pure-button-primary button-xsmall"
                                                        :class="{ 'pure-button-disabled': optionIndex === requirement.options.length - 1 }"
                                                        :disabled="optionIndex === requirement.options.length - 1"
                                                        @click="moveItem(requirement.options, optionIndex, false)">Down</button>
                                                    <button class="pure-button pure-button-primary button-xsmall"
                                                        @click="addRequirementOption(requirement.options, optionIndex, true)">Add
                                                        before</button>
                                                    <button class="pure-button pure-button-primary button-xsmall"
                                                        @click="addRequirementOption(requirement.options, optionIndex, false)">Add
                                                        after</button>
                                                    <button class="pure-button pure-button-primary button-xsmall"
                                                        :class="{ 'pure-button-disabled': requirement.options.length === 1 }"
                                                        :disabled="requirement.options.length === 1" @click="deleteItem(requirement.options, optionIndex)">Delete</button>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </template>
                            </td>
                            <td>
                                <button class="pure-button pure-button-primary button-xsmall" :class="{ 'pure-button-disabled': requirementIndex === 0 }"
                                    :disabled="requirementIndex === 0" @click="moveItem(requirements, requirementIndex, true)">Up</button>
                                <button class="pure-button pure-button-primary button-xsmall" :class="{ 'pure-button-disabled': requirementIndex === requirements.length - 1 }"
                                    :disabled="requirementIndex === requirements.length - 1" @click="moveItem(requirements, requirementIndex, false)">Down</button>
                                <button class="pure-button pure-button-primary button-xsmall" @click="addRequirement(requirementIndex, true)">Add
                                    before</button>
                                <button class="pure-button pure-button-primary button-xsmall" @click="addRequirement(requirementIndex, false)">Add
                                    after</button>
                                <button class="pure-button pure-button-primary button-xsmall" :class="{ 'pure-button-disabled': requirements.length === 1 }"
                                    :disabled="requirements.length === 1" @click="deleteItem(requirements, requirementIndex)">Delete</button>
                            </td>
                        </tr>
                    </tbody>
                </table>

                <h1>Cases table</h1>
                <table class="pure-table pure-table-bordered">
                    <thead>
                        <tr>
                            <th v-for="requirement in requirements">
                                {{ requirement.title }}
                            </th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr v-for="resultCase in resultCases">
                            <td v-for="resultCaseItem in resultCase">
                                <span v-html="resultCaseItem"></span>
                            </td>
                        </tr>
                    </tbody>
                </table>

                <h1>Cases list</h1>
                <ul>
                    <li v-for="resultCase in resultCases">
                        <strong>Parameters: </strong><template v-for="requirement in requirements.filter(r => r.type !== ControlTypes.RESULT)">{{
                            requirement.title }}: <span v-html="resultCase[requirements.indexOf(requirement)]"></span>&nbsp;</template>
                        <strong>Results: </strong><template v-for="requirement in requirements.filter(r => r.type === ControlTypes.RESULT)">{{
                            requirement.title }}: <span v-html="resultCase[requirements.indexOf(requirement)]"></span>&nbsp;</template>
                    </li>
                </ul>
            </div>
        </div>
    </div>
    </div> <!-- end content -->
</body>

</html>